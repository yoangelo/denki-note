openapi: 3.0.3
info:
  title: Timesheet API
  version: 0.1.0
servers:
  - url: ${VITE_API_ORIGIN}
paths:
  /health:
    get:
      operationId: health_check
      tags:
        - Health
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /auth/login:
    post:
      operationId: login
      tags:
        - Authentication
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  required:
                    - email
                    - password
                  properties:
                    email:
                      type: string
                      format: email
                    password:
                      type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
  /auth/logout:
    delete:
      operationId: logout
      tags:
        - Authentication
      summary: User logout
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: No active session
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
  /auth/signup:
    post:
      operationId: signup
      tags:
        - Authentication
      summary: User registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  required:
                    - email
                    - password
                    - display_name
                    - tenant_id
                  properties:
                    email:
                      type: string
                      format: email
                    password:
                      type: string
                      minLength: 6
                    password_confirmation:
                      type: string
                    display_name:
                      type: string
                    tenant_id:
                      type: string
                      format: uuid
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '422':
          description: Validation errors
  /customers:
    get:
      operationId: list_customers
      tags:
        - Customers
      summary: Incremental search customers
      parameters:
        - in: query
          name: query
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Customer'
  /customers/recent:
    get:
      operationId: get_recent_customers
      tags:
        - Customers
      summary: Get recently used customers with sites
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 3
            minimum: 1
            maximum: 10
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RecentCustomer'
  /sites:
    get:
      operationId: list_sites
      tags:
        - Sites
      summary: Search sites by customer
      parameters:
        - in: query
          name: customer_id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: query
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Site'
    post:
      operationId: create_site
      tags:
        - Sites
      summary: Create new site under a customer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - site
              type: object
              properties:
                site:
                  type: object
                  required:
                    - customer_id
                    - name
                  properties:
                    customer_id:
                      type: string
                      format: uuid
                    name:
                      type: string
                      maxLength: 200
                    note:
                      type: string
                      maxLength: 500
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Site'
  /daily_reports:
    get:
      operationId: list_daily_reports
      tags:
        - DailyReports
      summary: Get daily reports list with work entries
      parameters:
        - in: query
          name: year_month
          schema:
            type: string
            pattern: ^[0-9]{4}-[0-9]{2}$
          description: Filter by year-month (YYYY-MM format)
        - in: query
          name: user_id
          schema:
            type: string
            format: uuid
          description: Filter by user ID
        - in: query
          name: customer_id
          schema:
            type: string
            format: uuid
          description: Filter by customer ID
        - in: query
          name: site_id
          schema:
            type: string
            format: uuid
          description: Filter by site ID
        - in: query
          name: limit
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 500
          description: Limit number of results
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                required:
                  - daily_reports
                  - meta
                properties:
                  daily_reports:
                    type: array
                    items:
                      type: object
                      required:
                        - id
                        - work_date
                        - customer
                        - site
                        - summary
                        - work_entries
                        - total_minutes
                        - created_at
                        - updated_at
                      properties:
                        id:
                          type: string
                          format: uuid
                        work_date:
                          type: string
                          format: date
                        customer:
                          type: object
                          required:
                            - id
                            - name
                          properties:
                            id:
                              type: string
                              format: uuid
                            name:
                              type: string
                        site:
                          type: object
                          required:
                            - id
                            - name
                          properties:
                            id:
                              type: string
                              format: uuid
                            name:
                              type: string
                        summary:
                          type: string
                        work_entries:
                          type: array
                          items:
                            type: object
                            required:
                              - id
                              - user
                              - minutes
                            properties:
                              id:
                                type: string
                                format: uuid
                              user:
                                type: object
                                required:
                                  - id
                                  - display_name
                                properties:
                                  id:
                                    type: string
                                    format: uuid
                                  display_name:
                                    type: string
                              minutes:
                                type: integer
                        total_minutes:
                          type: integer
                        created_at:
                          type: string
                          format: date-time
                        updated_at:
                          type: string
                          format: date-time
                  meta:
                    type: object
                    required:
                      - total_count
                      - returned_count
                      - year_month
                    properties:
                      total_count:
                        type: integer
                      returned_count:
                        type: integer
                      year_month:
                        type: string
  /daily_reports/{id}:
    get:
      operationId: get_daily_report
      tags:
        - DailyReports
      summary: Get single daily report
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Daily report ID
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                required:
                  - daily_report
                properties:
                  daily_report:
                    type: object
                    required:
                      - id
                      - work_date
                      - customer
                      - site
                      - summary
                      - work_entries
                      - total_minutes
                      - created_at
                      - updated_at
                    properties:
                      id:
                        type: string
                        format: uuid
                      work_date:
                        type: string
                        format: date
                      customer:
                        type: object
                        required:
                          - id
                          - name
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                      site:
                        type: object
                        required:
                          - id
                          - name
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                      summary:
                        type: string
                      work_entries:
                        type: array
                        items:
                          type: object
                          required:
                            - id
                            - user
                            - minutes
                          properties:
                            id:
                              type: string
                              format: uuid
                            user:
                              type: object
                              required:
                                - id
                                - display_name
                              properties:
                                id:
                                  type: string
                                  format: uuid
                                display_name:
                                  type: string
                            minutes:
                              type: integer
                      total_minutes:
                        type: integer
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
        '404':
          description: Daily report not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /daily_reports/bulk_create:
    post:
      operationId: bulk_create_daily_reports
      tags:
        - DailyReports
      summary: Bulk create daily reports with work entries
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - daily_reports
              type: object
              properties:
                daily_reports:
                  type: array
                  minItems: 1
                  items:
                    required:
                      - site_id
                      - work_date
                      - summary
                      - work_entries
                    type: object
                    properties:
                      site_id:
                        type: string
                        format: uuid
                      work_date:
                        type: string
                        format: date
                      summary:
                        type: string
                      work_entries:
                        type: array
                        minItems: 1
                        items:
                          required:
                            - user_id
                            - minutes
                          type: object
                          properties:
                            user_id:
                              type: string
                              format: uuid
                            minutes:
                              type: integer
                              minimum: 0
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - summary
                  - reports
                  - errors
                properties:
                  success:
                    type: boolean
                  summary:
                    type: object
                    required:
                      - reports_created
                      - entries_created
                    properties:
                      reports_created:
                        type: integer
                      entries_created:
                        type: integer
                  reports:
                    type: array
                    items:
                      type: object
                  errors:
                    type: array
                    items:
                      type: object
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  summary:
                    type: object
                    properties:
                      reports_created:
                        type: integer
                      entries_created:
                        type: integer
                  reports:
                    type: array
                    items:
                      type: object
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        report_index:
                          type: integer
                        site_id:
                          type: string
                          format: uuid
                        error:
                          type: string
  /daily_reports/{id}/bulk_update:
    put:
      operationId: bulk_update_daily_report
      tags:
        - DailyReports
      summary: Bulk update daily report and work entries
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Daily report ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - daily_report
              properties:
                daily_report:
                  type: object
                  required:
                    - site_id
                    - summary
                    - work_entries
                  properties:
                    site_id:
                      type: string
                      format: uuid
                    summary:
                      type: string
                    work_entries:
                      type: array
                      minItems: 1
                      items:
                        type: object
                        required:
                          - user_id
                          - minutes
                        properties:
                          user_id:
                            type: string
                            format: uuid
                          minutes:
                            type: integer
                            minimum: 0
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - daily_report
                properties:
                  success:
                    type: boolean
                  daily_report:
                    type: object
                    required:
                      - id
                      - work_date
                      - customer
                      - site
                      - summary
                      - work_entries
                      - total_minutes
                      - updated_at
                    properties:
                      id:
                        type: string
                        format: uuid
                      work_date:
                        type: string
                        format: date
                      customer:
                        type: object
                        required:
                          - id
                          - name
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                      site:
                        type: object
                        required:
                          - id
                          - name
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                      summary:
                        type: string
                      work_entries:
                        type: array
                        items:
                          type: object
                          required:
                            - id
                            - user
                            - minutes
                          properties:
                            id:
                              type: string
                              format: uuid
                            user:
                              type: object
                              required:
                                - id
                                - display_name
                              properties:
                                id:
                                  type: string
                                  format: uuid
                                display_name:
                                  type: string
                            minutes:
                              type: integer
                      total_minutes:
                        type: integer
                      updated_at:
                        type: string
                        format: date-time
        '403':
          description: Forbidden - Admin access required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Daily report not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: object
  /daily_reports/{id}/destroy:
    delete:
      operationId: destroy_daily_report
      tags:
        - DailyReports
      summary: Soft delete daily report
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Daily report ID
      responses:
        '204':
          description: Successfully deleted (no content)
        '403':
          description: Forbidden - Admin access required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Daily report not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /auth/password:
    post:
      operationId: request_password_reset
      tags:
        - Authentication
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  required:
                    - email
                  properties:
                    email:
                      type: string
                      format: email
      responses:
        '200':
          description: Password reset instructions sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '422':
          description: Validation errors
    put:
      operationId: reset_password
      tags:
        - Authentication
      summary: Reset password with token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  required:
                    - reset_password_token
                    - password
                    - password_confirmation
                  properties:
                    reset_password_token:
                      type: string
                    password:
                      type: string
                      minLength: 8
                    password_confirmation:
                      type: string
      responses:
        '200':
          description: Password updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '422':
          description: Validation errors
  /auth/invitation:
    post:
      operationId: invite_user
      tags:
        - Admin
      summary: Invite a new user (admin only)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  required:
                    - email
                    - display_name
                  properties:
                    email:
                      type: string
                      format: email
                    display_name:
                      type: string
                    role_ids:
                      type: array
                      items:
                        type: string
                        format: uuid
      responses:
        '201':
          description: Invitation sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '403':
          description: Forbidden
        '422':
          description: Validation errors
    put:
      operationId: accept_invitation
      tags:
        - Authentication
      summary: Accept invitation and set password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  required:
                    - invitation_token
                    - password
                    - password_confirmation
                  properties:
                    invitation_token:
                      type: string
                    password:
                      type: string
                      minLength: 8
                    password_confirmation:
                      type: string
      responses:
        '200':
          description: Password set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '422':
          description: Validation errors
  /auth/invitations/pending:
    get:
      operationId: list_pending_invitations
      tags:
        - Admin
      summary: Get pending invitations (admin only)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    email:
                      type: string
                      format: email
                    display_name:
                      type: string
                    invitation_sent_at:
                      type: string
                      format: date-time
                    invitation_created_at:
                      type: string
                      format: date-time
        '403':
          description: Forbidden
  /admin/users:
    get:
      operationId: admin_list_users
      tags:
        - Admin
      summary: Get all users (admin only)
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: query
          schema:
            type: string
        - in: query
          name: role
          schema:
            type: string
            enum:
              - admin
              - member
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  meta:
                    type: object
                    properties:
                      total_count:
                        type: integer
                      returned_count:
                        type: integer
        '403':
          description: Forbidden
  /admin/users/{id}:
    get:
      operationId: admin_get_user
      tags:
        - Admin
      summary: Get user details (admin only)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '403':
          description: Forbidden
        '404':
          description: User not found
    put:
      operationId: admin_update_user
      tags:
        - Admin
      summary: Update user (admin only)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: object
                  properties:
                    display_name:
                      type: string
                    is_active:
                      type: boolean
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '403':
          description: Forbidden
        '404':
          description: User not found
        '422':
          description: Validation errors
    delete:
      operationId: admin_delete_user
      tags:
        - Admin
      summary: Delete user (admin only)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '403':
          description: Forbidden
        '404':
          description: User not found
        '422':
          description: Cannot delete yourself
  /admin/users/{id}/add_role:
    post:
      operationId: admin_add_role
      tags:
        - Admin
      summary: Add role to user (admin only)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role_name
              properties:
                role_name:
                  type: string
                  enum:
                    - admin
                    - member
      responses:
        '200':
          description: Role added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '403':
          description: Forbidden
        '404':
          description: User or role not found
        '422':
          description: Failed to add role
  /admin/users/{id}/roles/{role_id}:
    delete:
      operationId: admin_remove_role
      tags:
        - Admin
      summary: Remove role from user (admin only)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: role_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Role removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '403':
          description: Forbidden
        '404':
          description: User or role not found
        '422':
          description: Failed to remove role
  /users:
    get:
      operationId: list_users
      tags:
        - Users
      summary: Get users list
      parameters:
        - in: query
          name: is_active
          schema:
            type: boolean
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
  /summaries/customer-month:
    get:
      operationId: get_customer_month_summary
      tags:
        - Summaries
      summary: Get monthly hours & amount by customer
      parameters:
        - in: query
          name: customer_id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: yyyymm
          required: true
          schema:
            type: string
            pattern: ^[0-9]{4}-[0-9]{2}$
        - in: query
          name: rate_toggle
          schema:
            type: string
            enum:
              - 'on'
              - 'off'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                required:
                  - rows
                  - total_hours
                  - amount_jpy
                type: object
                properties:
                  rows:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date
                        summary:
                          type: string
                        hours:
                          type: number
                  total_hours:
                    type: number
                  amount_jpy:
                    type: integer
  /admin/customers:
    get:
      operationId: getAdminCustomers
      tags:
        - Admin
        - Customers
      summary: Get all customers (admin only)
      parameters:
        - in: query
          name: search
          schema:
            type: string
          description: Search by customer name (partial match)
        - in: query
          name: sort_by
          schema:
            type: string
            enum:
              - created_at
              - name
              - rate_percent
            default: created_at
          description: Sort by field
        - in: query
          name: sort_order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
          description: Sort order
        - in: query
          name: show_discarded
          schema:
            type: boolean
            default: false
          description: Include discarded customers
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  customers:
                    type: array
                    items:
                      $ref: '#/components/schemas/Customer'
        '403':
          description: Forbidden
  /admin/customers/create_bulk:
    post:
      operationId: createCustomerBulk
      tags:
        - Admin
        - Customers
      summary: Create customer with sites (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - customer
              properties:
                customer:
                  type: object
                  required:
                    - name
                    - customer_type
                    - rate_percent
                  properties:
                    name:
                      type: string
                    customer_type:
                      type: string
                      enum:
                        - individual
                        - corporate
                    corporation_number:
                      type: string
                    rate_percent:
                      type: integer
                      minimum: 0
                      maximum: 300
                    note:
                      type: string
                sites:
                  type: array
                  items:
                    type: object
                    required:
                      - name
                    properties:
                      name:
                        type: string
                      note:
                        type: string
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  customer:
                    $ref: '#/components/schemas/Customer'
                  sites:
                    type: array
                    items:
                      $ref: '#/components/schemas/Site'
        '403':
          description: Forbidden
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
  /admin/customers/{id}:
    get:
      operationId: getAdminCustomer
      tags:
        - Admin
        - Customers
      summary: Get customer detail (admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  customer:
                    $ref: '#/components/schemas/Customer'
                  sites:
                    type: array
                    items:
                      $ref: '#/components/schemas/Site'
        '403':
          description: Forbidden
        '404':
          description: Not Found
    patch:
      operationId: updateAdminCustomer
      tags:
        - Admin
        - Customers
      summary: Update customer (admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - customer
              properties:
                customer:
                  type: object
                  properties:
                    name:
                      type: string
                    customer_type:
                      type: string
                      enum:
                        - individual
                        - corporate
                    corporation_number:
                      type: string
                    rate_percent:
                      type: integer
                      minimum: 0
                      maximum: 300
                    note:
                      type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  customer:
                    $ref: '#/components/schemas/Customer'
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
    delete:
      operationId: deleteAdminCustomer
      tags:
        - Admin
        - Customers
      summary: Delete customer (admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: No Content
        '403':
          description: Forbidden
        '404':
          description: Not Found
  /admin/customers/check_duplicate:
    get:
      operationId: checkDuplicateCustomer
      tags:
        - Admin
        - Customers
      summary: Check if customer name already exists
      parameters:
        - in: query
          name: name
          schema:
            type: string
          required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  duplicate:
                    type: boolean
                  name:
                    type: string
  /admin/sites:
    post:
      operationId: createAdminSite
      tags:
        - Admin
        - Sites
      summary: Create site (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - site
              properties:
                site:
                  type: object
                  required:
                    - customer_id
                    - name
                  properties:
                    customer_id:
                      type: string
                      format: uuid
                    name:
                      type: string
                    note:
                      type: string
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  site:
                    $ref: '#/components/schemas/Site'
        '403':
          description: Forbidden
        '404':
          description: Customer Not Found
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
  /admin/sites/{id}:
    patch:
      operationId: updateAdminSite
      tags:
        - Admin
        - Sites
      summary: Update site (admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - site
              properties:
                site:
                  type: object
                  properties:
                    name:
                      type: string
                    note:
                      type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  site:
                    $ref: '#/components/schemas/Site'
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
    delete:
      operationId: deleteAdminSite
      tags:
        - Admin
        - Sites
      summary: Delete site (admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: No Content
        '403':
          description: Forbidden
        '404':
          description: Not Found
  /admin/tenant:
    get:
      operationId: admin_get_tenant
      tags:
        - Admin
        - Tenant
      summary: Get tenant settings (admin only)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  tenant:
                    $ref: '#/components/schemas/TenantSettings'
        '403':
          description: Forbidden
    patch:
      operationId: admin_update_tenant
      tags:
        - Admin
        - Tenant
      summary: Update tenant settings (admin only)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tenant
              properties:
                tenant:
                  type: object
                  properties:
                    name:
                      type: string
                    default_unit_rate:
                      type: integer
                      minimum: 0
                    time_increment_minutes:
                      type: integer
                      enum:
                        - 1
                        - 5
                        - 10
                        - 15
                        - 20
                        - 30
                        - 60
                    money_rounding:
                      type: string
                      enum:
                        - round
                        - ceil
                        - floor
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  tenant:
                    $ref: '#/components/schemas/TenantSettings'
        '403':
          description: Forbidden
        '422':
          description: Unprocessable Entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: _denki_note_session
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - time
        - message
      properties:
        status:
          type: string
          enum:
            - ok
        time:
          type: string
          format: date-time
        message:
          type: string
    Customer:
      type: object
      required:
        - id
        - name
        - customer_type
        - rate_percent
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        customer_type:
          type: string
          enum:
            - individual
            - corporate
        corporation_number:
          type: string
          nullable: true
        rate_percent:
          type: integer
          default: 100
        note:
          type: string
          nullable: true
        discarded_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Site:
      type: object
      required:
        - id
        - name
        - customer_id
      properties:
        id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        tenant_id:
          type: string
          format: uuid
        name:
          type: string
        note:
          type: string
          nullable: true
        discarded_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    User:
      type: object
      required:
        - id
        - display_name
        - is_active
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        display_name:
          type: string
        is_active:
          type: boolean
        tenant_id:
          type: string
          format: uuid
        roles:
          type: array
          items:
            type: string
        is_admin:
          type: boolean
        is_member:
          type: boolean
        created_at:
          type: string
          format: date-time
    RecentCustomer:
      type: object
      required:
        - id
        - name
        - site
        - last_used_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        customer_type:
          type: string
          enum:
            - individual
            - corporate
          nullable: true
        corporation_number:
          type: string
          nullable: true
        rate_percent:
          type: integer
          nullable: true
        site:
          type: object
          required:
            - id
            - name
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
        last_used_at:
          type: string
          format: date-time
    TenantSettings:
      type: object
      required:
        - id
        - name
        - default_unit_rate
        - time_increment_minutes
        - money_rounding
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        default_unit_rate:
          type: integer
        time_increment_minutes:
          type: integer
          enum:
            - 1
            - 5
            - 10
            - 15
            - 20
            - 30
            - 60
        money_rounding:
          type: string
          enum:
            - round
            - ceil
            - floor
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
